    <script>
        // función para guardar preferencias
        async function savePreferences(preferences) {
            window.currentPreferences = preferences;

            if (window.userId) {
                // usuario logueado: guardar en DB
                try {
                    const response = await fetch(`/api/usuarios/${window.userId}/preferences`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(preferences)
                    });

                    if (!response.ok) {
                        console.error('Error al guardar preferencias en DB');
                    }
                } catch (error) {
                    console.error('Error al guardar preferencias:', error);
                }
            } else {
                // usuario no logueado: guardar en localStorage
                localStorage.setItem("zap-theme", preferences.theme);
                sessionStorage.setItem("fontSize", preferences.fontSize);
                sessionStorage.setItem("contrastMode", preferences.contrastMode);
            }
        }

        // tamaño de fuente
        document.getElementById("font-size").addEventListener("change", async () => {
            const fontSize = document.getElementById("font-size").value;
            document.documentElement.style.setProperty("--zoom", fontSize);

            // guardar
            await savePreferences({
                ...window.currentPreferences,
                fontSize: fontSize
            });
        });

        // sincronizar select con valor ya aplicado en head
        if (window.currentPreferences && window.currentPreferences.fontSize) {
            document.getElementById("font-size").value = window.currentPreferences.fontSize;
        }

        // contraste y paleta
        document.getElementById("contrast-mode").addEventListener("change", async () => {
            const mode = document.getElementById("contrast-mode").value;

            // remover todas las clases de contraste previas
            document.body.classList.remove("high-contrast", "deuteranopia", "protanopia", "tritanopia");

            // añadir la clase correspondiente si no es normal
            if (mode !== "normal") {
                document.body.classList.add(mode);
            }

            // guardar
            await savePreferences({
                ...window.currentPreferences,
                contrastMode: mode
            });
        });

        // sincronizar select con valor ya aplicado en head
        if (window.currentPreferences && window.currentPreferences.contrastMode) {
            document.getElementById("contrast-mode").value = window.currentPreferences.contrastMode;
        }
    </script>
    </main>

    <footer class="p-4 text-secondary border-top border-dark" role="contentinfo">
        <p>&copy; COPYRIGHT 2025. ALL RIGHTS RESERVED.</p>
    </footer>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/theme.js"></script>
</body>

</html>
